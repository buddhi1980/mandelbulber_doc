\section{Materials}\label{materials}\index{materials}

\subsection{Defining and assigning materials}\label{defining-materials}\index{materials!defining}

A material defines the appearance of the surface and volume of an object and can be used to give an object an interesting or even a realistic look. A material which can be used in Mandelbulber can be just plain colors, colors generated by fractal properties, or colors from external files with textures. A material can also define physical properties of an object like transparency, reflectance, roughness or luminosity.

In the program materials can be defined as distinct entities which can be assigned to multiple objects. In the easiest scenario only one material could be used for all objects.

All defined materials are visible in the \emph{Materials} dock (figure \ref{materials_dock}).
From this window the user can manage the materials.

\simpleImageWithCaptionHalfWidth{img/manual/media/material_dock.png}
{Docked window with defined material}
{materials_dock}{h}

Clicking on a chosen material will bring up the \emph{Material editor}, where all material properties are visible.

The following options are available in this dock:

\begin{description}
		\item[New material] -- add new definition of a material
		\item[Delete material] -- delete selected material
		\item[Edit material] -- open separate window with \emph{Material editor}
		\item[Load material] -- open file selector for loading an already defined material
		\item[Save material as] -- open file selector for saving a material into a file
\end{description}

A material can be assigned to different types of objects: main fractal, boolean fractals or primitives. One material can me assigned to many objects. For every object there needs to be one assigned material.

\subsubsection{Assigning material to main fractal}\label{assigning-material-to-main-fractal}

To assign a material to the main fractal object go to \emph{Objects} dock and \emph{Global parameters} tab (figure \ref{materials_assign_to_main_fractal}). Clicking on the material icon will bring up the \emph{Material manager} window where the material can be selected. This selected material will be associated with the main fractal object. Further changes of the material properties in \emph{Material editor} will directly affect all objects with this assigned material.
\nopagebreak
\simpleImageWithCaptionHalfWidth{img/manual/media/material_assign_to_main_fractal.png}
{Material icon in Global parameters}
{materials_assign_to_main_fractal}{h}

\subsubsection{Assigning material to primitive object}\label{assigning-material-to-primitive}

To assign a material to a particular primitive object go to \emph{Objects} dock and \emph{Primitives} tab. Below the parameters of this primitive there is an icon for the material selection (figure \ref{materials_assign_to_primitive}).
 
\nopagebreak
\simpleImageWithCaptionHalfWidth{img/manual/media/material_assign_to_primitive.png}
{Material icon in definition of primitive object}
{materials_assign_to_primitive}{H}

\subsubsection{Assigning material to one of the fractals in boolean mode}\label{assigning-material-to-boolean}

To assign a material to a particular fractal when the boolean mode is enabled, go to \emph{Objects} dock and \emph{Fractals} tab. Then go to the formula tab of the fractal, which should be assigned with the material. The selection of the material is located below the fractal formula parameters (figure \ref{materials_assign_to_boolean}).

\nopagebreak
\simpleImageWithCaptionHalfWidth{img/manual/media/material_assign_to_boolean.png}
{Material icon below fractal formula parameters in boolean mode}
{materials_assign_to_boolean}{H}

\subsection{Editing parameters of materials}\label{materials-parameters}\index{materials!parameters}

The parameters of a material can be edited in the \emph{Material editor} dock. On the top of the material editor is a real-time preview of the material and the name of the material. The name can be edited freely for easier identification of the material.

\subsection{Gradients}\label{materials-gradients}

Gradients can be applied to fractal objects. If material with gradients is assigned to a primitive object, then gradient will be ignored and the plain color is used instead (parameter \emph{Surface color}) -- see figure \ref{materials_gradient_on_primitive}

\simpleImageWithCaptionHalfWidth{img/manual/media/material_gradients_on_primitives.png}
{Gradient applied to fractal and primitive objects}
{materials_gradient_on_primitive}{h}

\subsubsection{Gradient editor}\label{materials-gradient-editor}

For every parameter which uses a gradient there is the same type of gradient editor. A Gradient can have up to 100 intermediate colors. The first and the last color are always the same, because the gradient is repeated in a loop.

\simpleImageWithCaptionHalfWidth{img/manual/media/material_gradient_editor.png}
{Gradient editor}
{materials_gradient_edtor}{h}

The gradient editor has the following buttons (figure \ref{materials_gradient_edtor}):\index{materials!gradient editor}
\nopagebreak
\begin{description}
	\item[Defined colors (1)] -- colors used in the gradient. A double click on the color opens a window where the color can be changed. The color box can be moved along the gradient (only the first and last color cannot be moved)
	\item[Randomize colors (2)] -- randomizes all colors in the gradient
	\item[Randomize all (3)] -- randomizes the number of colors, their positions and the colors
	\item[Increase brightness (4)] -- increases brightness of all colors
	\item[Decrease brightness (5)] -- decreases brightness of all colors
	\item[Invert (6)] -- inverts all colors
	\item[Increase saturation (7)] -- increases saturation of all colors
	\item[Decrease saturation (8)] -- decreases saturation of all colors
\end{description}

Right click on the gradient opens the context menu which has the following options:
\nopagebreak
\begin{description}
	\item[Add] -- Adds new color box in the position of mouse pointer
	\item[Remove] -- Removes color box in the position of mouse pointer
	\item[Delete all] -- deletes all colors from the gradient. Only the first and last color are kept.
	\item[Change number of colors] -- changes number of colors with recalculation of color boxes
	\item[Grab colors from image] -- opens file selector to choose an image from which colors will be extracted
	\item[Load colors from file] -- opens file selector to choose a text file with an already defined gradient
	\item[Save colors to file] -- opens file selector where gradient will be saved as a text file.
	\item[Copy] -- copies gradient to clipboard. This can be used to copy all colors from one gradient to another one (e.g. to use the same colors for transparency as used for surface color)
	\item[Paste] -- pastes gradient from clipboard. 
\end{description}

\subsubsection{Gradient common options}\label{materials-gradient-common-options}

Gradients are used in the material when option \emph{Use colors from gradients} is enabled. Gradients can be used for the following channels: surface color, specular highlights, diffuse, luminosity, roughness, reflectance and transparency.

All of the channels have the following common settings:
\begin{description}
	\item[Palette offset] -- shift colors along the color palette (figures \ref{material-palette-offset-0}, \ref{material-palette-offset-02}, \ref{material-palette-offset-05})
	
	\threeImagesWithTwoCaptionsFullWidth
	{img/manual/media/material_palette_offset_0.png}
	{palette offset = 0}
	{material-palette-offset-0}
	{img/manual/media/material_palette_offset_02.png}
	{palette offset = 0.2}
	{material-palette-offset-02}
	{img/manual/media/material_palette_offset_05.png}
	{palette offset = 0.5}
	{material-palette-offset-05}
	
	\item[Color speed] -- frequency of color changing (figures \ref{material-color_speed_025}, \ref{material-color_speed_1}, \ref{material-color_speed_4})
	
	\threeImagesWithTwoCaptionsFullWidth
	{img/manual/media/material_color_speed_025.png}
	{color speed = 0.25}
	{material-color_speed_025}
	{img/manual/media/material_color_speed_1.png}
	{color speed = 1}
	{material-color_speed_1}
	{img/manual/media/material_color_speed_4.png}
	{color speed = 4}
	{material-color_speed_4}
\end{description}
	
\subsubsection{Coloring algorithms}\label{materials-coloring-algorithms}
	
Option \emph{Coloring algorithm} allows selection of the algorithm which will be used to distribute colors. These algorithms use particular properties of the fractal calculation (results of orbit trap algorithms)\index{orbit trap}

\begin{description}
	\item[Standard] -- color index is calculated as a length of z vector
	\begin{center}
		\(c = |z|\)
	\end{center}
	\simpleImageWithCaptionHalfWidth{img/manual/media/material_color_algorithm_standard.png}
	{Standard coloring algorithm}
	{material-coloring-standard}{H}
	
	\item[orbit trap: z.Dot(point)] -- color index is calculated as a dot product of z vector and point coordinates
	\begin{center}
		\(c = |z \cdot p|\)
	\end{center}
	\simpleImageWithCaptionHalfWidth{img/manual/media/material_color_algorithm_zdotpoint.png}
	{orbit trap: z.Dot(point) coloring algorithm}
	{material-coloring-zdotpoint}{H}
	
	\item[orbit trap: Sphere] -- color index is calculated as distance of z vector from sphere of radius defined by parameter \emph{Orbit trap sphere radius}
	\begin{center}
		\(c = ||z - p|-r|\)
	\end{center}
	\simpleImageWithCaptionHalfWidth{img/manual/media/material_color_algorithm_sphere.png}
	{orbit trap: Sphere coloring algorithm}
	{material-coloring-zdotpoint}{H}
	
	\item[orbit trap: Cross] -- color index is calculated as distance of z vector from orbit trap of cross shape
	\begin{center}
		\(c = \mathrm{min}(|z.x|, |z.y|, |z.z|)\)
	\end{center}
	\simpleImageWithCaptionHalfWidth{img/manual/media/material_color_algorithm_cross.png}
	{orbit trap: Cross coloring algorithm}
	{material-coloring-cross}{H}
	
	\item[orbit trap: Line] -- color index is calculated as distance of z vector from line defined by \emph{Orbit trap line direction vector}
	\begin{center}
		\(c = |z \cdot d|\)
	\end{center}
	\simpleImageWithCaptionHalfWidth{img/manual/media/material_color_algorithm_line_z1.png}
	{orbit trap: Line coloring algorithm (direction vector 0;0;1)}
	{material-coloring-line}{H}
\end{description}

\subsubsection{Gradient for surface color}\label{materials-surface_color-gradient}

Gradient for \emph{surface color} defines color channel of fractal surface. It is default way of coloring fractals.

\simpleImageWithCaptionHalfWidth{img/manual/media/material_color_algorithm_standard.png}
{Color gradient for fractal surface}
{material-color-gradient-example}{H}

\subsubsection{Gradient for specular highlights}\label{materials-specular-gradient}

Gradient for \emph{specular highlights} defines colors of specular effect. More details about this effects are in chapter \ref{materials-specular}

\simpleImageWithCaptionHalfWidth{img/manual/media/material_gradient_specular.png}
{Gradient for specular effect colors}
{material-color-gradient-example}{H}

\subsubsection{Gradient for diffuse}\label{materials-diffuse-gradient}

Gradient for \emph{specular highlights} defines intensity of diffuse channel. Brighter gradient causes stronger light diffusion which means wider specular highlights and less visible reflections. More details about specular highlights are in chapter \ref{materials-specular}

\simpleImageWithCaptionHalfWidth{img/manual/media/material_gradient_diffuse.png}
{Gradient for diffusion channel}
{material-color-gradient-example}{H}

\subsubsection{Gradient for luminosity}\label{materials-luminosity-gradient}

\subsubsection{Gradient for roughness}\label{materials-roughness-gradient}

\subsubsection{Gradient for reflectance}\label{materials-reflectance-gradient}

\subsubsection{Gradient for transparency}\label{materials-transparency-gradient}

\subsection{Surface color}\label{materials-surface_color}

\subsection{Shading}\label{materials-shading}

\subsection{Specular highlights}\label{materials-specular}

\subsection{Common options for textures}\label{materials-textures}

\subsection{Advanced parameters of materials}\label{materials-advanced}

Coloring of a fractal can be derived from the information that is available throughout the iteration process.
The simplest is coloring a point based on the original location of the point.
Next is coloring a point based on the final location of the point at termination of the iteration process.
However we can derive more complex algorithms based on data obtained during the iteration process (e.g orbit trap algorithms and auxColor algorithms).
All of the above can be used together to form even more complicated algorithms (e.g Mandelbox coloring options below).

\subsubsection{Color by numbers}\label{materials-color by numbers}

Color by numbers is a mathematical approach (which also helps with fractal calculation diagnostics).
if the Color Speed is at default 1.0, then a calculated colorValue of 2.5 will assign the color at a distance of 2.5 along the palette gradient.

\subsubsection{Mandelbox coloring options}\label{materials-mandelbox}








