\section{Materials}\label{materials}\index{materials}

\subsection{Defining and assigning materials}\label{defining-materials}\index{materials!defining}

A material defines the appearance of the surface and volume of an object and can be used to give an object an interesting or even a realistic look. A material which can be used in Mandelbulber can be just plain colors, colors generated by fractal properties, or colors from external files with textures. A material can also define physical properties of an object like transparency, reflectance, roughness or luminosity.

In the program, materials can be defined as distinct entities which can be assigned to multiple objects. In the easiest scenario, only one material could be used for all objects.

All defined materials are visible in the \emph{Materials} dock (figure \ref{materials_dock}).
From this window the user can manage the materials.

\simpleImageWithCaptionHalfWidth{img/manual/media/material_dock.png}
{Docked window with defined material}
{materials_dock}{h}

Clicking on a chosen material will bring up the \emph{Material editor}, where all material properties are visible.

The following options are available in this dock:

\begin{description}
		\item[New material] -- add new definition of a material
		\item[Delete material] -- delete selected material
		\item[Edit material] -- open separate window with \emph{Material editor}
		\item[Load material] -- open file selector for loading an already-defined material
		\item[Save material as] -- open file selector for saving a material into a file
\end{description}

A material can be assigned to different types of objects: main fractal, boolean fractals or primitives. One material can be assigned to many objects. For every object, there needs to be one assigned material.
\pagebreak
\subsubsection{Assigning material to main fractal}\label{assigning-material-to-main-fractal}

To assign a material to the main fractal object, go to \emph{Objects} dock and \emph{Global parameters} tab (figure \ref{materials_assign_to_main_fractal}). Clicking on the material icon will bring up the \emph{Material manager} window where the material can be selected. This selected material will be associated with the main fractal object. Further changes of the material properties in \emph{Material editor} will directly affect all objects with this assigned material.
\nopagebreak
\simpleImageWithCaptionThirdWidth{img/manual/media/material_assign_to_main_fractal.png}
{Material icon in Global parameters}
{materials_assign_to_main_fractal}{h}

\subsubsection{Assigning material to primitive object}\label{assigning-material-to-primitive}

To assign a material to a particular primitive object go to \emph{Objects} dock and \emph{Primitives} tab. Below the parameters of this primitive there is an icon for the material selection (figure \ref{materials_assign_to_primitive}).
 
\nopagebreak
\simpleImageWithCaptionThirdWidth{img/manual/media/material_assign_to_primitive.png}
{Material icon in definition of primitive object}
{materials_assign_to_primitive}{H}

\subsubsection{Assigning material to one of the fractals in boolean mode}\label{assigning-material-to-boolean}

To assign a material to a particular fractal when the boolean mode is enabled, go to \emph{Objects} dock and \emph{Fractals} tab. Then go to the formula tab of the fractal, which should be assigned with the material. The selection of the material is located below the fractal formula parameters (figure \ref{materials_assign_to_boolean}).

\nopagebreak
\simpleImageWithCaptionThirdWidth{img/manual/media/material_assign_to_boolean.png}
{Material icon below fractal formula parameters in boolean mode}
{materials_assign_to_boolean}{H}

\subsection{Editing parameters of materials}\label{materials-parameters}\index{materials!parameters}

The parameters of a material can be edited in the \emph{Material editor} dock. On the top of the material editor is a real-time preview of the material and the name of the material. The name can be edited freely for easier identification of the material.

\subsection{Gradients}\label{materials-gradients}

Gradients can be applied to fractal objects. If a material with gradients is assigned to a primitive object, then the gradient will be ignored and the plain color is used instead (parameter \emph{Surface color}) -- see figure \ref{materials_gradient_on_primitive}.

\simpleImageWithCaptionThirdWidth{img/manual/media/material_gradients_on_primitives.png}
{Gradient applied to fractal and primitive objects}
{materials_gradient_on_primitive}{h}

\subsubsection{Gradient editor}\label{materials-gradient-editor}

For every parameter which uses a gradient, there is the same type of gradient editor. A gradient can have up to 100 intermediate colors. The first and the last color are always the same, because the gradient is repeated in a loop.

\simpleImageWithCaptionHalfWidth{img/manual/media/material_gradient_editor.png}
{Gradient editor}
{materials_gradient_edtor}{h}

The gradient editor has the following buttons (figure \ref{materials_gradient_edtor}):\index{materials!gradient editor}
\nopagebreak
\begin{description}
	\item[Defined colors (1)] -- colors used in the gradient. A double click on the color opens a window where the color can be changed. The color box can be moved along the gradient (only the first and last color cannot be moved.)
	\item[Randomize colors (2)] -- randomizes all colors in the gradient.
	\item[Randomize all (3)] -- randomizes the number of colors, their positions and the colors.
	\item[Increase brightness (4)] -- increases brightness of all colors.
	\item[Decrease brightness (5)] -- decreases brightness of all colors.
	\item[Invert (6)] -- inverts all colors.
	\item[Increase saturation (7)] -- increases saturation of all colors.
	\item[Decrease saturation (8)] -- decreases saturation of all colors.
\end{description}

Right click on the gradient opens the context menu which has the following options:
\nopagebreak
\begin{description}
	\item[Add] -- adds new color box in the position of mouse pointer.
	\item[Remove] -- removes color box in the position of mouse pointer.
	\item[Delete all] -- deletes all colors from the gradient. Only the first and last color are kept.
	\item[Change number of colors] -- changes number of colors with recalculation of color boxes.
	\item[Grab colors from image] -- opens file selector to choose an image from which colors will be extracted.
	\item[Load colors from file] -- opens file selector to choose a text file with an already-defined gradient.
	\item[Save colors to file] -- opens file selector where gradient will be saved as a text file.
	\item[Copy] -- copies gradient to clipboard. This can be used to copy all colors from one gradient to another one, (e.g. to use the same colors for transparency as used for surface color.)
	\item[Paste] -- pastes gradient from clipboard. 
\end{description}

\subsubsection{Gradient common options}\label{materials-gradient-common-options}

Gradients are used in the material when option \emph{Use colors from gradients} is enabled. Gradients can be used for the following channels: surface color, specular highlights, diffuse, luminosity, roughness, reflectance and transparency.

All of the channels have the following common settings:
\begin{description}
	\item[Palette offset] -- shift colors along the color palette (figures \ref{material-palette-offset-0}, \ref{material-palette-offset-02}, \ref{material-palette-offset-05}.)
	
	\threeImagesWithTwoCaptionsFullWidth
	{img/manual/media/material_palette_offset_0.png}
	{palette offset = 0}
	{material-palette-offset-0}
	{img/manual/media/material_palette_offset_02.png}
	{palette offset = 0.2}
	{material-palette-offset-02}
	{img/manual/media/material_palette_offset_05.png}
	{palette offset = 0.5}
	{material-palette-offset-05}
	
	\item[Color speed] -- frequency of color changing (figures \ref{material-color_speed_025}, \ref{material-color_speed_1}, \ref{material-color_speed_4}.)
	
	\threeImagesWithTwoCaptionsFullWidth
	{img/manual/media/material_color_speed_025.png}
	{color speed = 0.25}
	{material-color_speed_025}
	{img/manual/media/material_color_speed_1.png}
	{color speed = 1}
	{material-color_speed_1}
	{img/manual/media/material_color_speed_4.png}
	{color speed = 4}
	{material-color_speed_4}
\end{description}
	
\subsubsection{Coloring orbit trap algorithms}\label{materials-coloring-0rbi-trap-algorithms}
	
Option \emph{Coloring algorithm} allows the selection of the orbit trap algorithm which will be used to distribute colors. These algorithms use particular properties of the fractal calculation (results of orbit trap algorithms.)\index{orbit trap}

\begin{description}
	\item[Standard] -- color index is calculated as the length of z vector
	\begin{center}
		\(c = |z|\)
	\end{center}
	\simpleImageWithCaptionThirdWidth{img/manual/media/material_color_algorithm_standard.png}
	{Standard coloring algorithm}
	{material-coloring-standard}{H}
	
	\item[orbit trap: z.Dot(point)] -- color index is calculated as the dot product of z vector and point coordinates
	\begin{center}
		\(c = |z \cdot p|\)
	\end{center}
	\simpleImageWithCaptionThirdWidth{img/manual/media/material_color_algorithm_zdotpoint.png}
	{orbit trap: z.Dot(point) coloring algorithm}
	{material-coloring-zdotpoint}{H}
	
	\item[orbit trap: Sphere] -- color index is calculated as the distance of z vector from a sphere of the radius defined by the parameter \emph{Orbit trap sphere radius}
	\begin{center}
		\(c = ||z - p|-r|\)
	\end{center}
	\simpleImageWithCaptionThirdWidth{img/manual/media/material_color_algorithm_sphere.png}
	{orbit trap: Sphere coloring algorithm}
	{material-coloring-sphere}{H}
	
	\item[orbit trap: Cross] -- color index is calculated as the distance of z vector from a cross shape orbit trap
	\begin{center}
		\(c = \mathrm{min}(|z.x|, |z.y|, |z.z|)\)
	\end{center}
	\simpleImageWithCaptionThirdWidth{img/manual/media/material_color_algorithm_cross.png}
	{orbit trap: Cross coloring algorithm}
	{material-coloring-cross}{H}
	
	\item[orbit trap: Line] -- color index is calculated as the distance of z vector from a line defined by \emph{Orbit trap line direction vector}
	\begin{center}
		\(c = |z \cdot d|\)
	\end{center}
	\simpleImageWithCaptionThirdWidth{img/manual/media/material_color_algorithm_line_z1.png}
	{orbit trap: Line coloring algorithm (direction vector 0;0;1)}
	{material-coloring-line}{H}
\end{description}

\textbf{4D orbit trap color.} Enables 4D orbit trap algorithms. Result varies depending on the 4D fractal chosen and which orbit trap algorithm is used.

\textbf{Pre-V2.15 orbit trap color}. Enables backwards compatibility. In version 2.15, changes were made to make orbit trap calculations the same for both OpenCL and  Non-OpenCL.

\subsubsection{Gradient for surface color}\label{materials-surface_color-gradient}

Gradient for \emph{surface color} defines the color channel for the fractal surface. It is the default method of coloring fractals.

\simpleImageWithCaptionThirdWidth{img/manual/media/material_color_algorithm_standard.png}
{Color gradient for fractal surface}
{material-color-gradient-example}{H}

\subsubsection{Gradient for specular highlights}\label{materials-specular-gradient}

Gradient for \emph{specular highlights} defines the colors of the specular effect. More details about this effect are in chapter \ref{materials-specular}.

\simpleImageWithCaptionThirdWidth{img/manual/media/material_gradient_specular.png}
{Gradient for specular effect colors}
{material-color-gradient-specular}{H}

\subsubsection{Gradient for diffuse}\label{materials-diffuse-gradient}.

Gradient for \emph{diffuse} defines the intensity of the diffuse channel. A brighter gradient causes stronger light diffusion, which means wider specular highlights and less visible reflections. More details about specular highlights are in chapter \ref{materials-specular}

\simpleImageWithCaptionThirdWidth{img/manual/media/material_gradient_diffuse.png}
{Gradient for diffusion channel}
{material-color-gradient-diffuse}{H}

\subsubsection{Gradient for luminosity}\label{materials-luminosity-gradient}
Gradient for \emph{luminosity} defines the intensity of the luminosity channel. This property is enabled when the \emph{luminosity} parameter has a value greater than zero. More details about luminosity are in chapter \ref{materials-luminosity}.

\simpleImageWithCaptionThirdWidth{img/manual/media/material_gradient_luminosity.png}
{Gradient for luminosity channel with enabled Monte Carlo Global Illumination and luminosity = 10}
{material-color-gradient-luminosity}{H}

\subsubsection{Gradient for roughness}\label{materials-roughness-gradient}

Gradient for \emph{roughness} defines the intensity of the roughness effect. This property has an effect when \emph{Rough surface} is enabled. More details about roughness are in chapter \ref{materials-roughness}.

\simpleImageWithCaptionThirdWidth{img/manual/media/material_gradient_roughness.png}
{Gradient for roughness intensity}
{material-color-gradient-roughness}{H}

\subsubsection{Gradient for reflectance}\label{materials-reflectance-gradient}

Gradient for \emph{reflectance} defines the amount and color of the reflected light. This property is enabled when the \emph{Reflectance} parameter is greater than zero. More details about reflectance are in chapter \ref{materials-reflectance}.

\simpleImageWithCaptionThirdWidth{img/manual/media/material_gradient_reflectance.png}
{Gradient for reflectance color and intensity}
{material-color-gradient-reflectance}{H}

\subsubsection{Gradient for transparency}\label{materials-transparency-gradient}

Gradient for \emph{transparency} defines the color of transparency and opacity. This property is enabled when the \emph{Transparency} parameter is greater than zero. 
It is recommended to use bright colors in the gradient for transparency. More details about transparency are in chapter \ref{materials-transparency}.

\simpleImageWithCaptionThirdWidth{img/manual/media/material_gradient_transparency_bright.png}
{Gradient for transparency color - example of bright colors to get high transparency}
{material-color-gradient-transparency-bright}{H}

\simpleImageWithCaptionThirdWidth{img/manual/media/material_gradient_transparency.png}
{Gradient for transparency color}
{material-color-gradient-transparency}{H}

\subsection{Surface color}\label{materials-surface_color}

This property defines the color of diffused light which is applied on the whole object. This color is used when \emph{surface color gradient} is disabled or when the material is applied to a primitive object.

\simpleImageWithCaptionThirdWidth{img/manual/media/material_surface_color.png}
{Different surface colors}
{material-surface-color-example}{H}

The option \emph{Use color texture from an image} allows the surface of objects to be covered with a colored texture from an image. More details about texture mapping are in chapter \ref{materials-textures}

\simpleImageWithCaptionThirdWidth{img/manual/media/material_texture_color.png}
{Objects with color texture}
{material-color-texture}{H}

Surface color (from color box) can be mixed with the color texture from an image file. The strength of the image influence can be adjusted with \emph{texture intensity} parameter.

\twoImagesWithTwoCaptionsFullWidth
{img/manual/media/material_texture_color_mixed.png}
{Different colors mixed with color texture}
{material-color-texture-mixed}
{img/manual/media/material_texture_color_intensity 05.png}
{Reduced intensity of color texture to 0.5}
{material-color-texture-mixed05}
{H}

\subsection{Shading}\label{materials-shading}

When \emph{shading} parameter is 1.0, then the surface brightness depends on the angle of incidence of light. Decreasing this parameter reduces the strength of this rule. When it is 0, then the surface color has the same brightness at every angle. 

\threeImagesWithTwoCaptionsFullWidth
{img/manual/media/material_shadng_0.png}
{shading = 0}
{material-shading-0}
{img/manual/media/material_shadng_05.png}
{shading = 0.5}
{material-shading-05}
{img/manual/media/material_shadng_1.png}
{shading = 1.0}
{material-shading-1}

\subsection{Specular highlights}\label{materials-specular}

Specular highlights are bright spots of light that appears on shiny objects when illuminated. This effect is very fast to calculate compared to light reflections. Specular highlights provide a strong visual cue for the shape of an object and its location with respect to light sources in the scene.
There are two types of highlights in Mandelbulber, which can be used simultaneously:
\begin{description}
	\item[Plastic specular reflections] where the color is the same as the light source color and doesn't depend on the surface color
	\item[Metallic specular reflections] where the color is a mix of the light source color and the surface color
\end{description}

\threeImagesWithTwoCaptionsFullWidth
{img/manual/media/material_specular_off.png}
{no highlights}
{material-specular off}
{img/manual/media/material_specular_plastic.png}
{plastic}
{material-specular-plastic}
{img/manual/media/material_specular_metallic.png}
{metallic}
{metallic-specular-metallic}

The following parameters are used to define the appearance of the specular highlights
\begin{description}
	\item[Specular highlight color] adds color to highlights
	\simpleImageWithCaptionThirdWidth{img/manual/media/material_specular_color.png}
	{Different colors of specular highlights}
	{material-specular-colors}{H}

	\item[Specular highlight brightness] controls the visibility of the highlights
	\threeImagesWithTwoCaptionsFullWidth
	{img/manual/media/material_specular_brigness_05.png}
	{brightness = 0.5}
	{material-specular-brightness-0}
	{img/manual/media/material_specular_brigness_2.png}
	{brightness = 2}
	{material-specular-brightness-05}
	{img/manual/media/material_specular_brigness_10.png}
	{brightness = 10}
	{material-specular-brightness-1}
	
	\item[Specular highlight width] controls the size of the bright spots
	\threeImagesWithTwoCaptionsFullWidth
	{img/manual/media/material_specular_width_0006.png}
	{width = 0.006}
	{material-specular-width-0006}
	{img/manual/media/material_specular_width_005.png}
	{width = 0.05}
	{material-specular-width-005}
	{img/manual/media/material_specular_width_02.png}
	{width = 0.2}
	{material-specular-width-02}
	
	\item[Roughness] controls the roughness of the metallic specular highlights
	\threeImagesWithTwoCaptionsFullWidth
	{img/manual/media/material_specular_metalic_roughness_01.png}
	{roughness = 0.1}
	{material-specular-roughness-01}
	{img/manual/media/material_specular_metalic_roughness_1.png}
	{roughness = 1}
	{material-specular-roughness-1}
	{img/manual/media/material_specular_metalic_roughness_10.png}
	{roughness = 10}
	{material-specular-roughness-10}	
		
\end{description}

\subsection{Rough surface}\label{materials-roughness}

\emph{Rough surface} property randomizes the direction of reflected and refracted light. This effect gives very good results when it is used with high reflectance. To get blurred reflections it is recommended to enable \emph{Monte Carlo algorithm} in \emph{Effect / Ray-tracing} tab. \emph{Roughness} parameter controls the intensity of the effect.

\threeImagesWithTwoCaptionsFullWidth
{img/manual/media/material_rougness_0.png}
{roughness = 0}
{material-surface-roughness-0}
{img/manual/media/material_rougness_001.png}
{roughness = 0.01}
{material-surface-roughness-001}
{img/manual/media/material_rougness_01.png}
{roughness = 0.1}
{material-surface-roughness-01}

Local roughness on the surface can be controlled by using a texture from an image file, when option \emph{Use roughness map texture} is enabled. Brighter areas of the texture will appear as higher roughness on the surface, whereas a black color appears as no roughness. More details about texture mapping are in chapter \ref{materials-textures}.

\twoImagesWithTwoCaptionsFullWidth
{img/manual/media/material_texture_roughness.png}
{Example use of roughness texture}
{material-roughness-texture-usage}
{img/manual/media/material_roughness_texture.jpg}
{Roughness texture used in this example}
{material-roughness-texture-example}
{H}

\subsection{Iridescence}\label{materials-iridescence}

\emph{Iridescence} effect creates a gradual change of color as the angle of view or the angle of illumination changes. In nature this phenomenon is visible on soap bubbles or on seashell nacre. 
Iridescence is visible on specular highlights, glossy or transparent surfaces. 

 \simpleImageWithCaptionThirdWidth{img/manual/media/material_iridescence.png}
 {Example of iridescence effect}
 {material-iridescence-example}{H}

In most cases, the default parameters of iridescence effect give satisfactory results. There are two parameters which control this effect.

\begin{description}
	\item[Intensity] controls the visibility of the iridescence effect
	
	\threeImagesWithTwoCaptionsFullWidth
	{img/manual/media/material_iridescence_intensity_1.png}
	{iridescence intensity = 1}
	{material-iridescence-intensity-1}
	{img/manual/media/material_iridescence_intensity_2.png}
	{iridescence intensity = 2}
	{material-iridescence-intensity-2}
	{img/manual/media/material_iridescence_intensity_4.png}
	{iridescence intensity = 4}
	{material-iridescence-intensity-4}
	
	\item[Subsurface relative thickness] controls the simulated thickness of the layer where iridescence is created. Higher value causes more frequent color changes but the effect is weaker.
	
	\threeImagesWithTwoCaptionsFullWidth
	{img/manual/media/material_iridescence_thickness_05.png}
	{Subsurface relative thickness = 0.5}
	{material-iridescence-thickness-05}
	{img/manual/media/material_iridescence_thickness_1.png}
	{Subsurface relative thickness = 1}
	{material-iridescence-thickness-1}
	{img/manual/media/material_iridescence_thickness_2.png}
	{Subsurface relative thickness = 2}
	{material-iridescence-thickness-2}
	
\end{description}

\subsection{Luminosity}\label{materials-luminosity}

\emph{Luminosity} property makes the surface bright even when the object is not illuminated by any light source. When \emph{Monte Carlo algorithm} and \emph{Calculate MC global illumination} are enabled, objects with high luminosity can illuminate other objects in the scene. 

\begin{description}
	\item[Luminosity] defines the intensity of the effect. To get the effect of illumination of the scene in\emph{ MC Global Illumination} mode, the \emph{luminosity} value has to be very high (about 5 - 100). 
	\item[Luminosity color] defines the color of the emitted light.
\end{description}

\simpleImageWithCaptionThirdWidth{img/manual/media/material_luminosity.png}
{High luminosity values (about 5) and MC global illumination enabled}
{material-luminosity}{H}

The luminosity effect can use a texture from an image file. The \emph{texture intensity} parameter adjusts the illumination intensity. More details about texture mapping are in chapter \ref{materials-textures}.

\twoImagesWithTwoCaptionsFullWidth
{img/manual/media/material_texture_luminosity.png}
{Example use of luminosity texture - texture intensity = 20}
{material-luminosity-texture-usage}
{img/manual/media/material_luminosity_texture.jpg}
{Luminosity texture used in this example}
{material-luminosity-texture-example}
{H}


\subsection{Reflectance}\label{materials-reflectance}

\emph{Reflectance} parameter controls the amount of light that is reflected by the object surface. When the value is 1.0, then 100\% of the light is reflected and the surface color is not visible (perfect mirror)

\textbf{Note: }This effect only work when in \emph{Effects} dock on tab \emph{Ray-tracing} when the option \emph{Ray-traced reflections and transparency} is enabled. With OpenCL, \emph{OpenCL mode: Full} must be used.

\threeImagesWithTwoCaptionsFullWidth
{img/manual/media/material_reflectance_02.png}
{Reflectance = 0.2}
{material-reflectance-02}
{img/manual/media/material_reflectance_05.png}
{Reflectance = 0.5}
{material-reflectance-05}
{img/manual/media/material_reflectance_1.png}
{Reflectance = 1.0}
{material-reflectance-1}

The quality and speed of the reflectance effect is controlled by \emph{Effects / Ray-tracing / Reflections depth}. This parameter controls the maximum number of light bounces to be calculated for a given pixel. A higher value gives a more realistic appearance but the calculation is much slower. In most cases a \emph{reflections depth} = 2 is enough for good quality and fast rendering.

\threeImagesWithTwoCaptionsFullWidth
{img/manual/media/material_reflections_depth_1.png}
{Reflections depth = 1}
{material-reflections-depth-1}
{img/manual/media/material_reflections_depth_2.png}
{Reflections depth = 2}
{material-reflections-depth-2}
{img/manual/media/material_reflections_depth_9.png}
{Reflections depth = 9}
{material-reflections-depth-9}

If you place an object inside a hollow primitive box that is made of reflective material ( a mirror box), then this parameter controls the number of repeated reflections.

\simpleImageWithCaptionThirdWidth{img/manual/media/material_reflections_hollow_box_depth_9.png}
{Hollow reflective box, reflections depth = 9}
{material-hollow-box}{H}

Option \emph{Fresnel's equations for reflectance} can simulate semi-glossy materials and produce more realistic reflections. When it is enabled, some of the light is reflected and some is diffused. The ratio depends on the angle of incidence of light. Parameter \emph{Index of refraction} also controls this ratio. Materials with a higher index of refraction (materials of higher density) will reflect more light. 

\threeImagesWithTwoCaptionsFullWidth
{img/manual/media/material_reflectance_fresnel_index_15.png}
{Enabled Fresnel's equations for reflectance. Index of refraction = 1.5}
{material-fresnel-index-15}
{img/manual/media/material_reflectance_fresnel_index_30.png}
{Enabled Fresnel's equations for reflectance. Index of refraction = 3.0}
{material-fresnel-index-30}
{img/manual/media/material_reflectance_fresnel_index_60.png}
{Enabled Fresnel's equations for reflectance. Index of refraction = 6.0}
{material-fresnel-index-60}

\emph{Color of reflections} colorizes reflected light.

\simpleImageWithCaptionThirdWidth{img/manual/media/material_reflections_color.png}
{Different colors of reflections}
{material-reflections-colors}{H}

Colorize reflections can use a texture map from an image file. Brighter areas of the texture will reflect more light, whereas a black color has no reflection. More details about texture mapping are in chapter \ref{materials-textures}.

\twoImagesWithTwoCaptionsFullWidth
{img/manual/media/material_texture_reflectance.png}
{Example use of reflectance texture}
{material-reflectance-texture-usage}
{img/manual/media/material_reflectance_texture.jpg}
{Reflectance texture used in this example}
{material-reflectance-texture-example}
{H}

\subsection{Transparency}\label{materials-transparency}

\emph{Transparency of surface} parameter controls the amount of light which can pass through the object surface. 
When the value of this property is 1.0, then the object surface is fully transparent. 

\threeImagesWithTwoCaptionsFullWidth
{img/manual/media/material_transparency_05.png}
{Transparency of surface = 0.5}
{material-transparency-05}
{img/manual/media/material_transparency_075.png}
{Transparency of surface = 0.75}
{material-transparency-075}
{img/manual/media/material_transparency_1.png}
{Transparency of surface = 1.0}
{material-transparency-1}

\textbf{Note: }This effect only works when the option \emph{Ray-traced reflections and transparency} is enabled in the \emph{Effects} dock on the \emph{Ray-tracing} tab. With OpenCL, \emph{OpenCL mode: Full} must be used.

The quality and speed of the transparency effect is controlled by \emph{Effects / Ray-tracing / Reflections depth}. This parameter controls the maximum number of light refractions to be calculated for a given pixel. A higher value gives a more realistic appearance but the calculation is much slower. In most cases a \emph{reflections depth} = 5 is enough for good quality. With transparency, when light is going through the object it passes two surfaces: when entering the object and when exiting. This means there needs to be at least two refractions calculated.

The parameter \emph{Maximum number of fractal iterations} (\emph{Rendering engine} dock), has a big impact on rendering speed. All fractal iterations are always calculated inside the fractal object, (outside the objects, only several iterations are calculated), which means a lot of mathematical calculations for every point of object volume. This parameter should be reduced to just before it causes differences in the fractal object shape. For instance a Mandelbulb only needs 5 iterations to get the correct shape. 

\emph{Color of transparency} colorizes light going through object surface. It behaves like a color filter.

\simpleImageWithCaptionThirdWidth{img/manual/media/material_transparency_colors.png}
{Different colors of transparency}
{material-transparency-colors}{H}

A much more realistic appearance of glass-like objects can be achieved by using transparency together with reflectance. In nature, every object which is transparent is also glossy. Good results will be achieved when \emph{transparency} = 1, \emph{reflectance} = 1 and \emph{Fresnel's equations for reflectance} is enabled, (as then there is calculated the correct ratio between reflected and refracted light). In this setup, the rendering can be much slower because for every point where light is refracted it is also reflected. For reflections depth = 5, there might be calculated up to 25 light bounces. 

\simpleImageWithCaptionThirdWidth{img/manual/media/material_transparency_1_reflectance_1.png}
{Surface transparency = 1, reflectance = 1, enabled Fresnel's equations for reflectance}
{material-reflectance-with-transparency}{H}

The light going through the transparent objects is refracted. The strength of light refraction depends on \emph{index of refraction}. Air has an index of refraction close to 1, water 1.35, glass 1.5 and diamond 2.4. A higher index of refraction also increases the amount of reflected light when \emph{Fresnel's equations for reflectance} is enabled.

\threeImagesWithTwoCaptionsFullWidth
{img/manual/media/material_transparency_index_1.png}
{Index of refraction = 1.0}
{material-transparency-index-1}
{img/manual/media/material_transparency_index_12.png}
{Index of refraction = 1.2}
{material-transparency-index-12}
{img/manual/media/material_transparency_index_20.png}
{Index of refraction = 2.0}
{material-transparency-index-20}

\emph{Transparency of volume} parameter controls the opacity of the interior of the object (independently from surface transparency). When it is 1.0 then the volume is fully transparent. Lower values make  the \emph{color of volume} more visible.

\threeImagesWithTwoCaptionsFullWidth
{img/manual/media/material_transparency_volume-09.png}
{Transparency of volume = 0.9}
{material-transparency-volume-09}
{img/manual/media/material_transparency_volume-07.png}
{Transparency of volume = 0.7}
{material-transparency-volume-07}
{img/manual/media/material_transparency_volume-05.png}
{Transparency of volume = 0.5}
{material-transparency-volume-05}

Colorize transparency can use a texture map from an image file. Brighter areas of the texture will pass more light, whereas a black color has no transparency. More details about texture mapping are in chapter \ref{materials-textures}.

\twoImagesWithTwoCaptionsFullWidth
{img/manual/media/material_texture_transparency.png}
{Example use of transparency texture}
{material-transparency-texture-usage}
{img/manual/media/material_transparency_texture.jpg}
{Transparency texture used in this example}
{material-transparency-texture-example}
{H}

\subsection{Diffusion texture}\label{materials-diffusion-texture}

Diffusion texture controls the amount and color of the reflected light. It also controls the intensity and width of the specular reflections.
Areas with brighter colors will reflect more light, the specular reflection will be brighter and the size of the specular reflections will be smaller (i.e. simulates polished surface.)
Dark areas will not reflect light, and the specular reflections will be dark and wide (i.e. simulates a rough surface). 

\twoImagesWithTwoCaptionsFullWidth
{img/manual/media/material_texture_diffuse.png}
{Example use of diffusion texture}
{material-diffusion-texture-example}
{img/manual/media/material_diffusion_texture.jpg}
{Used texture in the example}
{material-used-diffusion-texture}
{H}

\subsection{Normal map texture}\label{materials-normal-map-texture}

Normal mapping is a technique used for faking the lighting of bumps and dents – an implementation of bump mapping. Normal map texture changes locally the direction of the surface normal vector, (i.e. simulates local changes of the surface angle). It causes changes to the way that the light is reflected or diffused. Normal maps do not deform the object surface, but just give the appearance of deformation.

Normal map textures uses color components to define the direction of the deflection of a normal vector. Red represents X axis, green represents Y axis and blue represents Z axis. 

\twoImagesWithTwoCaptionsFullWidth
{img/manual/media/material_texture_normal.png}
{Example use of normal map texture}
{material-normal-texture-example}
{img/manual/media/normal_map_texture.jpg}
{Normal map texture used in this example}
{material-used-normal-texture}
{H}

There are two standards of normal maps. The difference between them is in the direction of the Y component of the normal vector. Visually when the Y component is swapped then the green component of the texture is inverted. The option \emph{Invert green (Y+ / Y-)} is used to configure the type of texture.

\twoImagesWithTwoCaptionsFullWidth
{img/manual/media/normal_map_texture.jpg}
{Standard normal map}
{material-texture-normal-standard}
{img/manual/media/normal_map_texture_g_inv.jpg}
{Inverted normal map}
{material-texture-normal-inverted}
{H}

To identify which standard it is, look how the colors are located on the convex part of the texture.
\begin{description}
\item[Standard]: top left corner - green, bottom right- red
\item[Inverted]: bottom left corner - green, right top - red
\end{description}
If you use an inverted texture, then check box  \emph{Invert green (Y+ / Y-)}  should be ticked.

Normal maps can be derived from height maps (bumpmaps). Enable \emph{Normal map texture derived from grayscale bump map} if a grayscale texture is used,

\twoImagesWithTwoCaptionsFullWidth
{img/manual/media/material_texture_normal_from_greyscale.png}
{Example use of greyscale bump map as a normal map}
{material-texture-normal-grayscale}
{img/manual/media/displacement_texture.jpg}
{Bump map used in this example}
{material-texture-bumpmap}
{H}

\subsection{Displacement map texture}\label{materials-texture-displacement}

Displacement map technique uses texture to cause an effect where the actual geometric position of points over the textured surface are displaced. It gives the surfaces a greater sense of depth and detail, and allows self-shadowing. In contrast to normal mapping, it deforms the object surface.
Displacement map textures looks the same as bump maps. Brighter pixels will give stronger embossing of the surface.

It is recommended to use 16-bit greyscale textures in PNG format to get smooth displacements.

Parameter \emph{Height of displacement} controls how much the surface will be deformed.

\textbf{Note:} displacement maps do not work with cubic mapping of textures.

\twoImagesWithTwoCaptionsFullWidth
{img/manual/media/material_texture_displacement.png}
{Example use of displacement map}
{material-texture-displacement-use}
{img/manual/media/displacement_texture.jpg}
{Displacement map used in this example}
{material-texture-displacement}
{H}

\subsection{Common options for textures}\label{materials-textures}

Mandelbulber can load textures in the following formats: JPEG, PNG, BMP and Radiance HDR. 

The default path to the texture files can be changed in \emph{File / Preferences} window.

 \simpleImageWithCaptionHalfWidth{img/manual/media/preferences_path_for_textures.png}
 {Default path to texture files}
 {preferences-textures-path}{H}
 
 In the bottom of \emph{Material editor} there are options for texture mapping
 
 \begin{description}
 	\item[Mapping type] defines how the texture is wrapped on an object surface
 	\begin{itemize}
 		\item Planar - the texture is stretched onto the xy plane
 		\item Spherical - the texture is projected onto a theoretical sphere
 		\item Cylindrical - the texture is projected onto a theoretical cylinder
 		\item Cubic - the texture is projected onto a theoretical cube. The cube surface is selected according to surface normal vector.
 	\end{itemize} 
 
	 \twoImagesWithTwoCaptionsFullWidth
	 {img/manual/media/texture_mapping_planar.png}
	 {Planar texture mapping}
	 {material-texture-planar}
	 {img/manual/media/texture_mapping_spherical.png}
	 {Spherical texture mapping}
	 {material-texture-spherical}
	 {H}
	 
	 \twoImagesWithTwoCaptionsFullWidth
	 {img/manual/media/texture_mapping_cylindrical.png}
	 {Cylindrical texture mapping}
	 {material-texture-cylindrical}
	 {img/manual/media/texture_mapping_cubic.png}
	 {Cubic texture mapping}
	 {material-texture-cubic}
	 {H}
	 
	 \item[Texture center] shifts the texture in x, y and z directions. A shift by 1 moves the texture by 1 x size of the texture.
	 
	 \item[Texture scale] scales the texture relatively to object size.
	 
	 \threeImagesWithTwoCaptionsFullWidth
	 {img/manual/media/texture_mapping_scale_05_05_05.png}
	 {Texture scale 0.5, 0.5, 0.5}
	 {texture-scale-05}
	 {img/manual/media/texture_mapping_cubic.png}
	 {Texture scale 1, 1, 1}
	 {texture-scale-1}
	 {img/manual/media/texture_mapping_scale_2_2_2.png}
	 {Texture scale 2, 2, 2}
	 {texture-scale-2}
	 
	 \item[Texture rotation] rotates the texture around x, y and z axis.
	 
	 \threeImagesWithTwoCaptionsFullWidth
	 {img/manual/media/texture_mapping_rot_alpha_45.png}
	 {Alpha angle 45\textdegree}
	 {texture-rot-alpha-45}
	 {img/manual/media/texture_mapping_rot_beta_45.png}
	 {Beta angle 45\textdegree}
	 {texture-rot-alpha-45}
	 {img/manual/media/texture_mapping_rot_gamma_45.png}
	 {Gamma angle 45\textdegree}
	 {texture-rot-alpha-45}
	 
	 \item[Fractalize texture]
	
 \end{description}




\subsection{Advanced color parameters}\label{materials-advanced-color-parameters}

Coloring of a fractal can be derived from the information that is available throughout the iteration process.

The simplest is coloring a point based on the original location of the point.
Next is coloring a point based on the final location of the point at the termination of the iteration process.

However, we can derive more complex algorithms based on data obtained during the iteration process, (e.g. orbit trap algorithms and aux.color algorithms).

All of the above can be used together to form even more complicated algorithms.

\textbf{Orbit trap} algorithms have already been covered above; however, more complex versions can be coded but they will increase calculation time. The orbit trap output is called \textbf{colorMin}.

\textbf{Aux.color} value is generally generated by whether an if() condition is met on an iteration. For instance, if(z.x \textgreater\space folding\_limit), then increase the aux.color by adding a value, if it does not, then the aux.color remains unchanged for that iteration. The final aux.color value for a point is the summation at termination. This generally results in color banding. However, some of the newer formulas have aux.color algorithms that do not produce color banding.

Aux.color components are often used with formulas that have box and sphere folds, as well as DIFS. Typically the UI looks like the following, but they are sometimes unique to the fractal.

\twoImagesWithTwoCaptionsFullWidth{img/manual/media/auxColor_folds.PNG}
{Box and Sphere fold UI}
{auxColor_folds}
{img/manual/media/auxColor_DIFS.PNG}
{DIFS UI}
{auxColor_DIFS.PNG}{H}

There are also a few transform-based color algorithms that use aux.color or aux.colorHybrid:

T>DIFS Hybrid Color - for coloring T>DIFS.

T>Hybrid Color - more options for coloring based on the points position at termination.

T>Hybrid Color2 - more options for coloring based on data from the iteration loop.

\subsubsection{Normal Mode Color (single formula mode and boolean mode)}\label{materials-normal-mode-color}

For each formula there is one of five color functions assigned.
These are different to hybrid mode color. Color by numbers allows for conversion between normal and hybrid modes.

The Mandelbox formula has an additional component called \emph{Absolute value of z}, this only works if the formula is in slot\#1.


\subsubsection{Extra Hybrid Mode Color Options}\label{materials-extra-hybrid-mode-color-options}

When in hybrid mode (and more than one slot is enabled), the color is calculated as the addition of three parts:

\(final color = orbit trap  +  aux.color  +  \frac{radius}{aux.DE}\)

With standard hybrid mode coloring, the ratio of the three parts is fixed.

With Extra Hybrid Mode Color Options enabled, the influence of the three parts can be scaled by weight. This also allows for some backwards compatibility with Pre V2.15 color. If Extra Hybrid Mode Color Options is disabled, then the calculation is run without the scales, and is faster.

\textbf{Notes: }The aux.color default value is 1.0; so even if the formula does not have any aux.color components, there still be some influence. Depending on the formula, the \(\frac{radius}{aux.DE}\) component may have little influence.

\subsubsection{Color by numbers}\label{materials-color-by-numbers}

Color by numbers is an exact mathematical approach (which also helps with fractal calculation diagnostics).

Color by numbers components are mixed by weights and the summation of the colorValue components is multiplied by 256 to produce the Final ColorValue.

With the default palette gradient and the Color Speed set to 1.0, then a 3D distance of 1.0 equates to a colorValue of 1.0 and a Final ColorValue of 256. Along the default palette, Final ColorValue 0 = Orange, 256 = Green, 512 = Pale Yellow, etc.
Knowing colorValue numbers allows us to manipulate colors in specific ways (from simple to complex).

The color palette size is 2560 Final ColorValue units long. In color by numbers, the palette repeats the sequence until it reaches the Maximum ColorValue limit.

\textbf{Initial colorValue}. Default is 0.0. Increasing this allows for the use of negative colorValues.

\textbf{ColorValue Initial Conditions Components}
By default, all points have an initial colorValue of 0.0. Here it is possible to change the initial colorValue based on the coordinates of the original point "c", (using radius\_c and c.x, c.y \& c.z.) Coloring can be applied using these functions alone or with other functions.

\twoImagesWithTwoCaptionsFullWidth{img/manual/media/initial_conditions.png}
{Mandelbox 12.0 high with 1.0 bands based on intial conditions}
{initial_conditions}
{img/manual/media/initial_conditions_pk.png}
{Using c.z for vertical variation}
{initial_conditions_pk}{H}

\textbf{Orbit trap component}. Apply a weight to the orbit trap output colorMin.

\textbf{Auxillary color components}. Apply weights to aux.color and aux.colorHybrid outputs obtained from some fractals and transforms.

\textbf{Radius components.} A component value is added based on the distance of the point from the origin at termination.
This is similar to one iteration of Standard orbit trap coloring. This is also used for some backwards compatibility issues.

\simpleImageWithCaptionThirdWidth{img/manual/media/pseudoK_Cbn_rad.png}
{Radius components}
{pseudoK_Cbn_rad}{H}

\textbf{Radius / DE components.} A component value is added based on the distance of the point from the origin divided by the DE value at termination. If the fractal has only DE based on scale, then this will have little effect as the radius will remain proportional to DE, but does work with pseudo kleinian. This is mainly used for some backwards compatibility issues.

\simpleImageWithCaptionThirdWidth{img/manual/media/pseudoK_Cbn_rad_de.png}
{Radius / DE components}
{pseudoK_Cbn_rad_de.png}{H}

\textbf{Axis Bias components.} These functions are tools to globally manipulate/distort the color across the fractal surfaces.
 
\twoImagesWithTwoCaptionsFullWidth{img/manual/media/xyz_bias.png}
{XYZ bias}
{xyz_bias}
{img/manual/media/pseudoK_Cbn_xyz.png}
{XYZ bias}
{pseudoK_Cbn_xyz}{H}

\textbf{ColorValue iteration components.} As this is iteration based, it produces color banding. It requires one or more of the previous components to be enabled.

\simpleImageWithCaptionThirdWidth{img/manual/media/pseudoK_Cbn_iter_comp.png}
{iteration components}
{pseudoK_Cbn_iter_comp}{H}

\textbf{Final ColorValue Controls}
Thes palette deforming options have been superseded to some extent by the implementation of the adjustable palette gradient. The last component Round is still useful.

These functions add a varying value to the Final ColorValue. The starting point of the function along the palette can be set, so as to control the location of the beginning of the deformation.

These functions are calculated before getting the RGB color from the palette. They only manipulate Final ColorValues, so they need a range of colorValue inputs to work. These functions are global and work on the whole palette. The default palette is linear, with the colors spaced evenly apart, with a smooth symmetrical transition between each of them. The first three curve functions effectively deform the palette such that the colors are no longer evenly spaced.

The additionCurve function (for lack of a better name) is an inverse function, producing a steep curve that levels off towards a known value. Low colorValue colors will come closer together and high colorValues will all increase by approximately the same amount.

\simpleImageWithCaptionThirdWidth{img/manual/media/col_add_curve.png}
{addition curve function}
{col_add_curve}{H}

The parabolic curve produces gradual change over low colorValues in comparison to rapid increase for higher colorValues.

\simpleImageWithCaptionThirdWidth{img/manual/media/col_para.png}
{parabolic function}
{col_para}{H}

The trig curve is sinusoidal. The additions to deform the palette are derived from a cos curve (period = 1 covers a 256-unit length of the palette. A very large period makes it work similar to a parabolic.

\simpleImageWithCaptionThirdWidth{img/manual/media/col_trig.png}
{trig function}
{col_trig}{H}

The round option produces uniformly-colored bands with no transitions.

\simpleImageWithCaptionThirdWidth{img/manual/media/col_round.png}
{round function}
{col_round}{H}

Minimum and Maximum Final ColorValue parameters limit the palette and can be helpful in determining what colorValue is producing a certain area of color.







